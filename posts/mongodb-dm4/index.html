<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Patterns 2" /><meta name="author" content="Babin" /><meta property="og:locale" content="en" /><meta name="description" content="Computed Patttern Some computations are complex and if we store the operands of the computation separately, we can end up with poor peformance." /><meta property="og:description" content="Computed Patttern Some computations are complex and if we store the operands of the computation separately, we can end up with poor peformance." /><link rel="canonical" href="https://babin411.github.io/posts/mongodb-dm4/" /><meta property="og:url" content="https://babin411.github.io/posts/mongodb-dm4/" /><meta property="og:site_name" content="Babin Joshi" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-06-17T00:00:00+05:45" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Patterns 2" /><meta name="twitter:site" content="@BabinJoshi411" /><meta name="twitter:creator" content="@Babin" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Babin"},"dateModified":"2022-06-20T15:34:18+05:45","datePublished":"2022-06-17T00:00:00+05:45","description":"Computed Patttern Some computations are complex and if we store the operands of the computation separately, we can end up with poor peformance.","headline":"Patterns 2","mainEntityOfPage":{"@type":"WebPage","@id":"https://babin411.github.io/posts/mongodb-dm4/"},"url":"https://babin411.github.io/posts/mongodb-dm4/"}</script><title>4. Patterns 2 | Babin Joshi</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Babin Joshi"><meta name="application-name" content="Babin Joshi"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /assets/img/dp.png " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Babin Joshi</a></div><div class="site-subtitle font-italic">Life is a cruel prank played on the living - Charles Boyle</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/babin411" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/BabinJoshi411" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['j.babin411','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>4. Patterns 2</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>4. Patterns 2</h1><div class="post-meta text-muted"><div> By <em> <a href="https://twitter.com/Babinjoshi411">Babin Joshi</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1655403300" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-06-17 </em> </span> <span> Updated <em class="timeago" data-ts="1655718558" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-06-20 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1851 words"> <em>10 min</em> read</span></div></div></div><div class="post-content"><h2 id="computed-patttern"><span class="mr-2">Computed Patttern</span><a href="#computed-patttern" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Some computations are complex and if we store the operands of the computation separately, we can end up with poor peformance.</p><ul><li><p>Math operations: sum, average, median,â€¦ usually calling a built-in function on the server. E.g. Keeping track of ticket sales. Instead of summing up the screenings docs every time a movie is displayed, we save the sum and update it whenever a new screening document comes in.</p><li><p>Fan-out operations: do many tasks to represent a logical task. Two schemes: fan-out reads and read from different locations when reading, of fan-out writes that involves multiple write operations but not fanning-out when reading.</p><li><p>Roll-up operations: is a drill-down operation, data is meged together. Grouping time-series data from small intervals into larger ones is a good example of rolling-up. E.g. reporting hourly, daily, monthly or yearly summaries. All math operations are roll-ups, but we can think of roll-ups as a grouping operation.</p></ul><p>Doing the roll-up at the right time makes more sense than always doing it when reading the aggregation.</p><p><strong>Problems</strong></p><ul><li>Costly computational manipulation of data<li>Executed frequently on the same data with same result</ul><p><strong>Solution</strong></p><ul><li>Perform the operation and store the result in the appropiate document or collection<li>If need to redo calculation keep source of our computations</ul><p><strong>Use Cases</strong></p><ul><li>IoT, event sourcing, time-series data, frequent aggregations</ul><p><strong>Benefits/Trade-offs</strong></p><ul><li>âœ” Faster read queries<li>âœ” Saving resources (CPU/disk)<li>âœ˜ Difficult to indentify the need<li>âœ˜ Do not overuse as complexity increases</ul><h2 id="bucket-patterns"><span class="mr-2">Bucket Patterns</span><a href="#bucket-patterns" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>In the IoT world, having 10 million temperature sensors, each sending temp data every minute means 36 billion pieces of information oer hour. Storing each readout as a document, means too many docs to manage.</p><p>Keeping one document per device means the 16 MB limit per document will be reached sooner or later. Or the big documents are not manageable.</p><p>A suggestion is one doc per, device per day. Every new day a new document will be created. The doc contains an array per hour. This easy-to-understand-for-human structure makes it difficult to average the temp for a given period =&gt; get the array or section for each hour of the period and do the calculation. Maybe a single array for a day makes more sense. Besides, if data is not coming, the position needs to be inserted with missing (null) entry.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>    {
        _id: "device_id",
        date: ISODate("2018-03-01"),
        temp: [
            [20, 20, 20.1, ...],
            [21.1, 20.9,...],
            ...
        ]
    }
</pre></table></code></div></div><p>Another suggestion is have a document per device, per hour. There are 24 times more documents, but they are smaller. Beside, the temperatures are in an object with a minute key. For missing data, the value for the minute key will simply not be there.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>    {
        _id: "device_id",
        date: ISODate("2018-03-01T13"),
        temp: 
            {1: 20, 2: 20, 3: 20.1, ...}
        ]
    }
    {
        _id: "device_id",
        date: ISODate("2018-03-01T14"),
        temp: 
            {1: 20, 2: 20, 3: 20.1, ...}
        ]
    }
</pre></table></code></div></div><p>There are multiple ways of a bucketing and each one is fit for a set of operations.</p><p>Another example when bucketing comes handy is storing message in a chat app with many channels. We can create a documetn per channel per day, for instance. It makes easy to archive or shard to a cheaper storage based on date.</p><p>Another usage is mimicking column-oriented databases to bring only the data that is needed for each document, instead of the whole document. In the IoT world, imagine that a device pushes multiple fields. We can create a bucket with the values for each field and a different document contains only one field. It becomes very efficient to calculate on a single field.</p><p><strong>Gotchas</strong></p><ul><li>Random insertion and deletion in buckets.<li>Difficult sorting across buckets<li>Ad-hoc queries are more complex across buckets<li>Works best when complexity is hidden behind application.</ul><p><strong>Problem</strong></p><ul><li>Avoiding too many documents or too big documents 1-* that canâ€™t be embedded.</ul><p><strong>Solution</strong> Define optimal amount of info and store it in an array in the main object.</p><p>It is a embedded 1-* with N docs, each having an average sub-docs</p><p><strong>Use Cases</strong> IoT, data-warehousing, lots of information associated to a document</p><p><strong>Benefits/Trade-offs</strong></p><ul><li>âœ” Good-balance between data access and size of data returned<li>âœ” Makes data more manageable<li>âœ” Easy to prune data<li>âœ˜ Can lead to poor query results if not designed correctly<li>âœ˜ Less friendly to BI tools as bucketing needs to be understood by queries</ul><h2 id="schema-versioning-pattern"><span class="mr-2">Schema Versioning Pattern</span><a href="#schema-versioning-pattern" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Schema is going to change, but mongo allows those changes without downtime because the schema is flexible.</p><p>We can have documents that have a property and other documents with another array property. Each will be annotated with the version of the schema that it conforms to. In a relational database there is only one schema per table.</p><p>The application will have to handle all different versions of the document. Additionally, the document can be brought forward to the latest version whenever is retrieved. When all docs are migrated to the latest version, it is up to us to remove the previous version handlers.</p><p>Optionally, docs can be migrated via background jobs.</p><p><strong>Problem</strong></p><ul><li>Avoid downtime doing schema updates<li>Upgrade docs can take way too long<li>Not all documents need to be updated</ul><p><strong>Solution</strong></p><ul><li>Each doc has a schema version.<li>The app can handle all version<li>Pick a strategy to migrate the docs.</ul><p><strong>Use Cases</strong></p><ul><li>Every app the has a production-deployed db<li>Systems with a lot of legacy data</ul><p><strong>Benefits/Trade-offs</strong></p><ul><li>âœ” No downtime<li>âœ” Full control of migrations process<li>âœ” Less technical debt<li>âœ˜ May need multiple indexes fot the same field during migration period</ul><h3 id="tree-patterns"><span class="mr-2">Tree Patterns</span><a href="#tree-patterns" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>Model hierarchical information.</p><p>There are several use cases for hirarchies between objects/nodes: organization charts, books in bookstore or product categorization.</p><p>There are a set of common operations that are useful for these hierarchical data:</p><ul><li>find ancestors of node X (faX)<li>find reports to Y (frY)<li>Find all nodes under Z (fuZ) move children from parent N to parent P (mNP) â€¦ Documents are hierarchical by nature.</ul><p><strong>Structures</strong> There are several structures that can be combined. For example, using ancestors array and parent reference:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>{
    _id: 8,
    name: "Umbrellas",
    parent: "Fashion",
    ancestors: ["Swag", "Fashion"]
}
</pre></table></code></div></div><p>to get the benefits of optimal operations from each model: frY, fuZ</p><p><strong>Parent references</strong> Doc has a ref to parent.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>    {
        name: "&lt;string&gt;",
        parent: "name_of_parent"
    }
</pre></table></code></div></div><ul><li>faX is an aggregation with <code class="language-plaintext highlighter-rouge">$graphlookup</code> of the inmediate parents =&gt; !<li>frY .find({parent: â€˜Yâ€™}) =&gt; y<li>fuZ is straighforward, but iteration over several docs is needed =&gt; !<li>mNP is single update where parent = N =&gt; y</ul><p><strong>Child references</strong> Doc has an array property with inmediate children</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>{
    name: "&lt;string&gt;",
    children: ["child_1", "child_2", ...]
}
</pre></table></code></div></div><ul><li>faX =&gt; !<li>frY =&gt; !<li>fuZ is really simple and a single query .find(name: Z, {children: 1}) =&gt; y<li>mNP =&gt; !</ul><p><strong>Array of ancestors</strong> Doc has a ancestors array that represent the ancestors path.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>{
    name: "&lt;string&gt;",
    ancestors: ["parent", "grandparent", "great-grandparent"...]
}
</pre></table></code></div></div><ul><li>faX .find({name: X}, {ancestors: 1}) =&gt; y<li>frY =&gt; y<li>fuZ =&gt; y<li>mNP =&gt; !</ul><p><strong>Materialized paths</strong> Doc as a ancestors string that represents ancestors path with a delimiter.</p><p>{ name: â€œ<string>", ancestors: "parent.grandparent.great-grandparent" }</string></p><ul><li>faX .find({ancestors: /.Y$/} ) =&gt; y<li>frY =&gt; !<li>fuZ =&gt; !<li>mNP =&gt; !</ul><p><strong>Problem</strong></p><ul><li>Represent hierarchical structured data<li>different access patterns to navigate the tree<li>Optimize for common operations</ul><p><strong>Solution</strong> Use one or more:</p><ul><li>child reference<li>parent reference<li>array of ancestors<li>materialized paths</ul><p><strong>Use Cases</strong></p><ul><li>Org charts<li>Categorization</ul><p><strong>Benefits/Trade-offs</strong></p><ul><li>âœ” child reference: easy to navigate to children or tree descending access<li>âœ” parent reference: immediate parent discovery and tree updates<li>âœ” array of ancestor: navigate upward the ancestor path<li>âœ” materialized path: use regex to find nodes in tree</ul><h2 id="polymorphic-pattern"><span class="mr-2">Polymorphic Pattern</span><a href="#polymorphic-pattern" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Organizing documents by either what is common or by what is different: same or different collection.</p><p>Different collections involves more difficulties to find query results that come from both collections. =&gt; Group things together because we want to query them together.</p><p>E.g. vehicles collection that have cars (owner, taxes, #wheels), trucks (owner, taxes, #wheels, #axels) and boats (owner, taxes). Some doc types have properties that others have not. Having a vehicle discriminator (vehicle_type) is the canonic implementation of a polymorphic collection, because determines the expected shape of the document.</p><p>Another case of polymorphism occurs in embedded sub-documents. For example a customer with several addresses in different countries. Addresses are different by country, containing different properties. Based on the country we can infer the shape of the sub-document.</p><p>This pattern is commonly applied when we need a single (unified) view of the different types of documents. The relational solution to this problem is sub-optimal. When using document databases, the solution is much simpler.</p><p>The schema versioning pattern is a case of polymorphic pattern. With the version being the discriminator.</p><p><strong>Problem</strong></p><ul><li>Store in a single view (collection) objects that are more similar than different.</ul><p><strong>Solution</strong></p><ul><li>Use a discriminator field that tracks the type of document or sub-document.</ul><p>The application is responsible to treat each type accordingly</p><p><strong>Use Cases</strong></p><ul><li>single-view systems<li>product catalogs<li>content management systems</ul><p><strong>Benefits/Trade-offs</strong></p><ul><li>âœ” Easy to implement<li>âœ” Allows queries across a single collection</ul><h2 id="approximation-pattern"><span class="mr-2">Approximation Pattern</span><a href="#approximation-pattern" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Reduce the resources needed to perform some write operations.</p><p>For example, tracking page views can be achieved writing to the db each time a page is viewed, but it can be too many writes whenever there are hundreds of thousands visits a day. Instead, we increment +10 or +100 once in a while.</p><p><strong>Problem</strong></p><ul><li>Data is expensive to calculate<li>Precission is not critical</ul><p><strong>Solution</strong></p><ul><li>Fewer writes, but with higher payload</ul><p>The application is responsible to treat each type accordingly</p><p><strong>Use Cases</strong></p><ul><li>visit counters<li>Counters tolerant to precision<li>Metric statistics</ul><p><strong>Benefits/Trade-offs</strong></p><ul><li>âœ” Less writes<li>âœ” Less contention on documents<li>âœ” Statistically valid numbers<li>âœ˜ Not exact numbers<li>âœ˜ Application must implement the correct write logic</ul><h2 id="outlier-pattern"><span class="mr-2">Outlier Pattern</span><a href="#outlier-pattern" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Handling documents that stand out from the rest.</p><p>In big data scenarios, means you have few orders of magnitude higher than the norm.</p><p>For example, famous singers have hundreths of millions followers, while majority have less than 1000.</p><p>Outlier can drive developers to develop for the corner case, making it sub-optimal for 99% of the cases and hurting majority of queries.</p><p>For example, tracking the names of the extras in a movie. For most movies, can embed the less than 1000 names in an array. For those movies that many more extras we can overflow that array into another collection and flag the originating document as an outlier. The application will know that the list of extras overflows into another collection.</p><p><strong>Problem</strong></p><ul><li>Few document could drive the overall solution<li>Managing those few documents would impact negatively majority of the queries</ul><p><strong>Solution</strong></p><ul><li>Implement a solution that works for majority<li>Identify the exceptional docs with a field<li>Handle outliers differently</ul><p><strong>Use Cases</strong></p><ul><li>Social networks<li>Popularity<li>Metric statistics</ul><p><strong>Benefits/Trade-offs</strong></p><ul><li>âœ” Optimized solution for most use cases<li>âœ˜ Difference handle in the application<li>âœ˜ Difficult aggregated or ad-hoc queries (bc exception is handled application-side)</ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/mongodb/'>MongoDB</a>, <a href='/categories/mongodb-data-modeling/'>MongoDB Data Modeling</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/mongodb/" class="post-tag no-text-decoration" >mongodb</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=4. Patterns 2 - Babin Joshi&amp;url=https://babin411.github.io/posts/mongodb-dm4/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=4. Patterns 2 - Babin Joshi&amp;u=https://babin411.github.io/posts/mongodb-dm4/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://babin411.github.io/posts/mongodb-dm4/&amp;text=4. Patterns 2 - Babin Joshi" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/wildcards/">Wild Cards Tutorial</a><li><a href="/posts/Linux-Basic-Commands/">Basic Linux Commands</a><li><a href="/posts/3sql4/">Window Functions</a><li><a href="/posts/pandas1/">Introduction to Pandas</a><li><a href="/posts/mongodb-dm4/">4. Patterns 2</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/sql/">sql</a> <a class="post-tag" href="/tags/t-sql/">t-sql</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/mongodb/">mongodb</a> <a class="post-tag" href="/tags/curl/">curl</a> <a class="post-tag" href="/tags/wget/">wget</a> <a class="post-tag" href="/tags/avg/">avg</a> <a class="post-tag" href="/tags/count/">count</a> <a class="post-tag" href="/tags/max/">max</a> <a class="post-tag" href="/tags/min/">min</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/mongodb-dm1/"><div class="card-body"> <em class="timeago small" data-ts="1655316900" > 2022-06-16 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>1. Introduction to Data Modeling</h3><div class="text-muted small"><p> One of the most common misconceptions about data modeling in MongoDB is that modeling is schemaless, meaning that it doesnâ€™t really matter which field documents have or how different the documents ...</p></div></div></a></div><div class="card"> <a href="/posts/mongodb-dm2/"><div class="card-body"> <em class="timeago small" data-ts="1655316900" > 2022-06-16 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>2. Introduction to Relationships</h3><div class="text-muted small"><p> Relationships with MongoDB Even if MongoDB is classified as a document database, the pieces of information stored in the database still have relationships between them. Understanding how to represe...</p></div></div></a></div><div class="card"> <a href="/posts/mongodb-dm3/"><div class="card-body"> <em class="timeago small" data-ts="1655403300" > 2022-06-17 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>3. Patterns 1</h3><div class="text-muted small"><p> Patterns Patterns are very exciting because they are the most powerful tool for designing schemas for MongoDB and NoSQL. Patterns are not full solution to problems. Those are called full solutions....</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/mongodb-dm3/" class="btn btn-outline-primary" prompt="Older"><p>3. Patterns 1</p></a> <a href="/posts/pandas1/" class="btn btn-outline-primary" prompt="Newer"><p>Introduction to Pandas</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> Â© 2022 <a href="https://twitter.com/Babinjoshi411">Babin Joshi</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/sql/">sql</a> <a class="post-tag" href="/tags/t-sql/">t-sql</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/mongodb/">mongodb</a> <a class="post-tag" href="/tags/curl/">curl</a> <a class="post-tag" href="/tags/wget/">wget</a> <a class="post-tag" href="/tags/avg/">avg</a> <a class="post-tag" href="/tags/count/">count</a> <a class="post-tag" href="/tags/max/">max</a> <a class="post-tag" href="/tags/min/">min</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
